{% extends 'user/base_generic.html' %}
{% block title %}Мои заявки{% endblock %}
{% block content %}
  <h2>Мои заявки</h2>

  <form method="get" action="">
    <label>Фильтр по статусу
      <select name="status">
        <option value="">Все</option>
        <option value="new" {% if status_filter == 'new' %}selected{% endif %}>Новая</option>
        <option value="in_progress" {% if status_filter == 'in_progress' %}selected{% endif %}>Принято в работу</option>
        <option value="done" {% if status_filter == 'done' %}selected{% endif %}>Выполнено</option>
      </select>
    </label>
    <button type="submit">Применить</button>
  </form>

  {% if user_requests %}
    <ul>
      {% for r in user_requests %}
        <li>
          <time>{{ r.created_at|date:"d.m.Y H:i" }}</time>
          <strong>{{ r.title }}</strong> — {{ r.description|truncatechars:120 }}
          <br>Категория: {{ r.category.name }} | Статус: {{ r.get_status_display }}
          <div>
            {% if r.status not in ('in_progress','done') %}
              <a href="{% url 'confirm_delete' r.id %}">Удaлить</a>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>Заявок нет.</p>
  {% endif %}
{% endblock %}
